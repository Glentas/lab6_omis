@startuml
' ======== АКТОРЫ (ИСПОЛЬЗУЮТСЯ В USE CASE) ========
actor "Студент / Автор" as StudentAuthor
actor "Преподаватель / Рецензент" as TeacherReviewer
actor "Администратор системы" as Admin

' ======== КЛАССЫ И ИХ СТРУКТУРА ========

' --- Пользователь ---
class User {
  - userId: int {id}
  - name: string
  - email: string
  - role: UserRole
  - registrationDate: Date
  + login(email: string, password: string): boolean
  + uploadDocument(file: File): SourceDocument
  + viewReport(reportId: int): Report
  + getDocumentHistory(): List<SourceDocument>
}

' --- Статус обработки ---
enum ProcessingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ERROR
}

' --- Исходный документ ---
class SourceDocument {
  - docId: int {id}
  - fileName: string
  - format: DocumentFormat
  - fileSize: long
  - uploadDate: Date
  - userId: int {fk}
  + validateFormat(): boolean
  + getFileExtension(): string
  + isSupported(): boolean
}

' --- Обработанный текст ---
class ProcessedText {
  - textId: int {id}
  - docId: int {fk}
  - extractedText: string
  - status: ProcessingStatus
  - processedDate: Date
  + extractTextFrom(file: File): string
  + normalize(): void
  + removeStopWords(): void
  + validateText(): boolean
  + getTextLength(): int
}

' --- Проверка ---
class PlagiarismCheck {
  - checkId: int {id}
  - docId: int {fk}
  - userId: int {fk}
  - checkDate: Date
  - status: CheckStatus
  - uniquePercentage: decimal
  + startAnalysis(): void
  + getAnalysisProgress(): decimal
  + calculateUniqueness(): decimal
  + getResults(): CheckResult
}

' --- Результат проверки ---
class CheckResult {
  - resultsId: int {id}
  - checkId: int {fk}
  - matches: List<Match>
  - uniquenessScore: decimal
  + getMatches(): List<Match>
  + getUniquenessScore(): decimal
  + getSourceList(): List<Source>
}

' --- Совпадение ---
class Match {
  - matchId: int {id}
  - checkId: int {fk}
  - sourceId: int {fk}
  - positionInText: string
  - matchPercentage: decimal
  - fragmentContext: string
  + getMatchDetails(): MatchDetails
  + getFragmentContext(): string
}

' --- Источник ---
class Source {
  - sourceId: int {id}
  - sourceName: string
  - author: string
  - url: string
  - publicationDate: Date
  - category: string
  + getSourceInfo(): SourceInfo
  + validate(): boolean
}

' --- Отчет ---
class Report {
  - reportId: int {id}
  - checkId: int {fk}
  - userId: int {fk}
  - generatedDate: Date
  - uniquePercentage: decimal
  - matchCount: int
  + generateReport(check: PlagiarismCheck): Report
  + exportToPDF(): void
  + visualizeMatches(): FormattedReport
  + getSummary(): ReportSummary
}

' --- Подсистема предобработки ---
class TextPreprocessor {
  - preprocessorId: int {id}
  - algorithm: string
  - version: string
  + extractTextFrom(file: File): string
  + normalizeText(text: string): string
  + removeStopWords(text: string): string
  + validateText(text: string): boolean
}

' --- Подсистема анализа ---
class AnalysisEngine {
  - engineId: int {id}
  - algorithm: string
  - version: string
  + analyzeText(text: ProcessedText): List<Match>
  + compareWithSources(text: string, sources: List<Source>): List<Match>
  + calculateSimilarity(text1: string, text2: string): decimal
}

' --- База данных источников ---
class SourceDatabase {
  - dataId: int {id}
  - sourceName: string
  - recordCount: int
  - lastUpdate: Date
  + addSource(source: Source): void
  + removeSource(sourceId: int): void
  + searchSimilar(query: string): List<Source>
  + updateDatabase(): void
}

' --- Сессия пользователя ---
class Session {
  - sessionId: int {id}
  - userId: int {fk}
  - loginTime: Date
  - logoutTime: Date
  + createSession(userId: int): void
  + closeSession(): void
  + isActive(): boolean
}

' --- Интерфейсный элемент ---
class UIElement {
  - elementId: int {id}
  - elementName: string
  - elementType: string
  - description: string
  + handleClick(): void
  + updateState(data: string): void
}

' --- Статус проверки ---
enum CheckStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

' ======== СВЯЗИ МЕЖДУ КЛАССАМИ ========

' --- Пользователь ---
User "1" --> "0..*" SourceDocument : uploads
User "1" --> "0..*" Session : has
User "1" --> "0..*" Report : receives

' --- Исходный документ ---
SourceDocument "1" --> "1" ProcessedText : transforms into

' --- Проверка ---
PlagiarismCheck "1" --> "1" ProcessedText : analyzed in
PlagiarismCheck "1" --> "0..*" Match : creates
PlagiarismCheck "1" --> "1" CheckResult : produces

' --- Результат проверки ---
CheckResult "1" --> "0..*" Match : contains
CheckResult "1" --> "0..*" Source : refers to

' --- Совпадение ---
Match "1" --> "1" Source : refers to

' --- Отчет ---
Report "1" --> "1" PlagiarismCheck : generated by
Report "1" --> "0..*" Match : contains

' --- Подсистема предобработки ---
TextPreprocessor "1" --> "1" ProcessedText : creates

' --- Подсистема анализа ---
AnalysisEngine "1" --> "1" PlagiarismCheck : initiates
AnalysisEngine "1" --> "0..*" Source : receives
AnalysisEngine "1" --> "0..*" Match : finds

' --- База данных источников ---
SourceDatabase "1" --> "0..*" Source : stored in

' --- Сессия пользователя ---
Session "1" --> "0..*" UIElement : interacts with

@enduml
